<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± â€” {{ company }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%);
      min-height: 100vh;
      color: #fff;
    }

    .header {
      text-align: center;
      padding: 30px 20px 20px;
    }

    .header h1 {
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 4px;
    }

    .header .date {
      color: #7dd3fc;
      font-size: 1rem;
      font-weight: 600;
    }

    .clock {
      font-size: 3rem;
      font-weight: 900;
      color: #38bdf8;
      text-align: center;
      margin: 8px 0 4px;
      letter-spacing: 2px;
    }

    .sync-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 8px 20px;
      font-size: 13px;
      font-weight: 700;
    }

    .sync-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .sync-dot.green {
      background: #22c55e;
      box-shadow: 0 0 8px #22c55e;
      animation: pulse 2s infinite;
    }

    .sync-dot.orange {
      background: #f59e0b;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: 0.5
      }
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 16px;
      padding: 20px;
      max-width: 1100px;
      margin: 0 auto;
    }

    .emp-card {
      background: rgba(255, 255, 255, 0.07);
      border: 1.5px solid rgba(255, 255, 255, 0.12);
      border-radius: 20px;
      padding: 20px;
      transition: transform 0.2s, background 0.2s;
      cursor: pointer;
    }

    .emp-card:hover {
      transform: translateY(-4px);
      background: rgba(255, 255, 255, 0.12);
    }

    .emp-card.checked-in {
      border-color: #22c55e;
      background: rgba(34, 197, 94, 0.1);
    }

    .emp-card.checked-out {
      border-color: #f59e0b;
      background: rgba(245, 158, 11, 0.1);
    }

    .emp-card.late {
      border-color: #f59e0b;
    }

    .emp-name {
      font-size: 1.2rem;
      font-weight: 900;
      margin-bottom: 4px;
    }

    .emp-title {
      font-size: 0.85rem;
      color: #94a3b8;
      margin-bottom: 14px;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 800;
    }

    .badge-none {
      background: rgba(148, 163, 184, 0.2);
      color: #94a3b8;
    }

    .badge-in {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
    }

    .badge-out {
      background: rgba(245, 158, 11, 0.2);
      color: #fbbf24;
    }

    .badge-late {
      background: rgba(245, 158, 11, 0.25);
      color: #fb923c;
    }

    .time-row {
      display: flex;
      gap: 8px;
      margin: 10px 0;
      flex-wrap: wrap;
    }

    .time-chip {
      padding: 3px 10px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 800;
    }

    .punch-btn {
      width: 100%;
      padding: 12px;
      border-radius: 14px;
      border: none;
      font-family: 'Cairo';
      font-size: 16px;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 12px;
    }

    .btn-checkin {
      background: linear-gradient(135deg, #0ea5e9, #38bdf8);
      color: #fff;
    }

    .btn-checkout {
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
      color: #fff;
    }

    .btn-checkin:hover {
      transform: scale(1.03);
    }

    .btn-checkout:hover {
      transform: scale(1.03);
    }

    .toast {
      position: fixed;
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      padding: 14px 32px;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 900;
      z-index: 9999;
      animation: slideIn 0.3s ease;
      display: none;
    }

    .toast.success {
      background: linear-gradient(135deg, #16a34a, #22c55e);
    }

    .toast.error {
      background: linear-gradient(135deg, #dc2626, #ef4444);
    }

    @keyframes slideIn {
      from {
        top: 0;
        opacity: 0
      }

      to {
        top: 24px;
        opacity: 1
      }
    }

    .admin-link {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      text-decoration: none;
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.2s;
      cursor: pointer;
    }

    .admin-link:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .unsynced-badge {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(245, 158, 11, 0.3);
      border: 1px solid #f59e0b;
      color: #fbbf24;
      padding: 10px 18px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 800;
      display: none;
    }

    /* PIN Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.active {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      background: #1e293b;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 900;
      margin-bottom: 8px;
    }

    .modal-subtitle {
      color: #94a3b8;
      font-size: 0.95rem;
      margin-bottom: 24px;
    }

    .pin-input {
      width: 100%;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 14px;
      padding: 16px;
      font-size: 2rem;
      text-align: center;
      color: #fff;
      font-family: monospace;
      letter-spacing: 12px;
      margin-bottom: 20px;
      transition: border-color 0.2s;
    }

    .pin-input:focus {
      outline: none;
      border-color: #38bdf8;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
    }

    .btn-cancel {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      font-family: 'Cairo';
      font-weight: 800;
      font-size: 15px;
      cursor: pointer;
    }

    .btn-submit {
      flex: 2;
      padding: 14px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #0ea5e9, #38bdf8);
      color: #fff;
      font-family: 'Cairo';
      font-weight: 800;
      font-size: 15px;
      cursor: pointer;
    }

    .btn-cancel:hover,
    .btn-submit:hover {
      opacity: 0.9;
    }

    .btn-unlink {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.4);
      color: #fca5a5;
      padding: 10px 18px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 800;
      cursor: pointer;
      display: none;
      transition: all 0.2s;
    }

    .btn-unlink:hover {
      background: rgba(239, 68, 68, 0.4);
    }

    .hidden-card {
      display: none !important;
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>ğŸ¢ {{ company }}</h1>
    <div class="clock" id="clock">--:--:--</div>
    <div class="date">{{ today }}</div>
  </div>

  <div class="sync-bar">
    <div class="sync-dot" id="syncDot" style="background:#94a3b8"></div>
    <span id="syncText">ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ (ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„Ù…Ø­Ù„ÙŠ)...</span>
  </div>

  <div class="grid" id="empGrid">
    {% for emp in employees %}
    {% set record = att_map.get(emp.id) %}
    <div
      class="emp-card {% if record %}{% if record.check_out_time %}checked-out{% elif record.status == 'late' %}late checked-in{% else %}checked-in{% endif %}{% endif %}"
      id="card-{{ emp.id }}" data-emp-id="{{ emp.id }}">
      <div class="emp-name">{{ emp.name }}</div>
      <div class="emp-title">{{ emp.job_title or 'Ù…ÙˆØ¸Ù' }}</div>
      <div>
        {% if record %}
        {% if record.status == 'late' %}
        <span class="status-badge badge-late">â° Ù…ØªØ£Ø®Ø±</span>
        {% elif record.check_out_time %}
        <span class="status-badge badge-out">âœ… Ø§Ù†ØµØ±Ù</span>
        {% else %}
        <span class="status-badge badge-in">ğŸŸ¢ Ø­Ø§Ø¶Ø±</span>
        {% endif %}
        {% else %}
        <span class="status-badge badge-none">Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¨Ø¹Ø¯</span>
        {% endif %}
      </div>
      <div class="time-row" id="times-{{ emp.id }}">
        {% if record and record.check_in_time %}
        <span class="time-chip" style="background:rgba(34,197,94,0.2);color:#4ade80">â†— {{ record.check_in_time[:5]
          }}</span>
        {% endif %}
        {% if record and record.check_out_time %}
        <span class="time-chip" style="background:rgba(245,158,11,0.2);color:#fbbf24">â†˜ {{ record.check_out_time[:5]
          }}</span>
        {% endif %}
      </div>
      <button
        class="punch-btn {% if record and not record.check_out_time %}btn-checkout{% else %}btn-checkin{% endif %}"
        onclick="punch({{ emp.id }})" id="btn-{{ emp.id }}">
        {% if record %}
        {% if record.check_out_time %}ğŸ”„ ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø¬Ø¯ÙŠØ¯{% else %}ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù{% endif %}
        {% else %}
        âœ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±
        {% endif %}
      </button>
    </div>
    {% endfor %}
    {% if not employees %}
    <div style="grid-column:1/-1;text-align:center;padding:60px 20px;color:#94a3b8">
      <div style="font-size:4rem;margin-bottom:16px">ğŸ‘¤</div>
      <div style="font-size:1.2rem;font-weight:800">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙˆÙ†</div>
      <div style="margin-top:8px;font-size:0.9rem">Ø§Ø¶ØºØ· <a href="/admin" style="color:#38bdf8">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a> Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
        Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</div>
    </div>
    {% endif %}
  </div>

  <button onclick="requireAdminPin('/admin')" class="admin-link">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
  {% if sync_status.unsynced_count > 0 %}
  <!-- Keeping this around but changing position statically if needed, or moved to left to avoid clash with unlink -->
  <div class="unsynced-badge" style="display:block; right: auto; left: 120px;">ğŸ“¤ {{ sync_status.unsynced_count }} Ø³Ø¬Ù„
    ØºÙŠØ± Ù…Ø²Ø§Ù…Ù†</div>
  {% endif %}

  <button onclick="requireAdminPin('unlink')" class="btn-unlink" id="btnUnlink">ğŸ”“ ÙÙƒ Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ù‡Ø§ØªÙ</button>

  <div class="toast" id="toast"></div>

  <!-- PIN Modal -->
  <div class="modal-overlay" id="pinModal">
    <div class="modal-content">
      <div class="modal-title">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ©</div>
      <div class="modal-subtitle">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ (PIN) Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„Ø±Ø¨Ø· Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø­Ø³Ø§Ø¨Ùƒ Ø¨ØµÙØ© Ø¯Ø§Ø¦Ù…Ø©.</div>
      <input type="password" class="pin-input" id="pinInput" maxlength="4" placeholder="â€¢â€¢â€¢â€¢" autocomplete="off"
        inputmode="numeric">
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closePinModal()">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn-submit" onclick="submitPin()">ØªØ£ÙƒÙŠØ¯ ÙˆØ±Ø¨Ø· Ø§Ù„Ù‡Ø§ØªÙ</button>
      </div>
    </div>
  </div>

  <script>
    // Clock
    function updateClock() {
      const now = new Date();
      document.getElementById('clock').textContent =
        String(now.getHours()).padStart(2, '0') + ':' +
        String(now.getMinutes()).padStart(2, '0') + ':' +
        String(now.getSeconds()).padStart(2, '0');
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Toast
    function showToast(msg, type = 'success') {
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.className = 'toast ' + type;
      el.style.display = 'block';
      setTimeout(() => { el.style.display = 'none'; }, 3500);
    }

    // Punch in/out
    async function punch(empId) {
      const deviceId = localStorage.getItem('kiosk_device_id');

      if (!deviceId) {
        // This device is not linked yet! Open the PIN modal instead.
        openPinModal(empId);
        return;
      }

      const btn = document.getElementById('btn-' + empId);
      btn.disabled = true;
      const originalText = btn.textContent;
      btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ...';
      let res;
      let data;
      try {
        res = await fetch('/checkin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ employee_id: empId, device_id: deviceId })
        });
        data = await res.json();
        if (data.success) {
          const action = data.action;
          const rec = data.record;
          const timesEl = document.getElementById('times-' + empId);
          const card = document.getElementById('card-' + empId);
          // Update times
          let timesHtml = '';
          if (rec.check_in_time) timesHtml += `<span class="time-chip" style="background:rgba(34,197,94,0.2);color:#4ade80">â†— ${rec.check_in_time.slice(0, 5)}</span>`;
          if (rec.check_out_time) timesHtml += `<span class="time-chip" style="background:rgba(245,158,11,0.2);color:#fbbf24">â†˜ ${rec.check_out_time.slice(0, 5)}</span>`;
          timesEl.innerHTML = timesHtml;
          // Update card style and button
          if (action === 'check_in') {
            card.className = 'emp-card ' + (rec.status === 'late' ? 'late checked-in' : 'checked-in');
            btn.className = 'punch-btn btn-checkout';
            btn.textContent = 'ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù';
            showToast(`âœ… Ù…Ø±Ø­Ø¨Ø§Ù‹ ${data.employee_name}${rec.status === 'late' ? ' â€” Ù…ØªØ£Ø®Ø±' : ''}`, rec.status === 'late' ? 'error' : 'success');
          } else {
            card.className = 'emp-card checked-out';
            btn.className = 'punch-btn btn-checkin';
            btn.textContent = 'ğŸ”„ ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø¬Ø¯ÙŠØ¯';
            showToast(`ğŸ‘‹ Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ${data.employee_name}`, 'success');
          }
        } else {
          showToast(data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
          if (res.status === 403) {
            // Invalid device ID! Unlink forcefully
            unlinkDevice(true);
          }
        }
      } catch (e) {
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±', 'error');
      }
      btn.disabled = false;
      if (!data?.success && res?.status !== 403) {
        btn.textContent = originalText;
      }
    }

    // Check internet connectivity
    async function checkConnectivity() {
      try {
        await fetch('/sync_now', { method: 'POST' });
        document.getElementById('syncDot').className = 'sync-dot green';
        document.getElementById('syncText').textContent = 'Ù…ØªØµÙ„ â€” ÙŠØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©';
      } catch {
        document.getElementById('syncDot').style.background = '#f59e0b';
        document.getElementById('syncText').textContent = 'ÙˆØ¶Ø¹ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª â€” Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹';
      }
    }
    setTimeout(checkConnectivity, 2000);

    // --- Device Linking Logic ---
    let pendingEmpId = null;

    function generateDeviceId() {
      return 'dev_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
    }

    function checkDeviceStatus() {
      const linkedEmployeeId = localStorage.getItem('kiosk_linked_employee_id');
      const allCards = document.querySelectorAll('.emp-card');
      const unlinkBtn = document.getElementById('btnUnlink');

      if (linkedEmployeeId) {
        // Device is linked. Hide all cards except the linked one.
        allCards.forEach(card => {
          if (card.dataset.empId === linkedEmployeeId) {
            card.classList.remove('hidden-card');
          } else {
            card.classList.add('hidden-card');
          }
        });
        unlinkBtn.style.display = 'block';
      } else {
        // Not linked. Show all cards.
        allCards.forEach(card => card.classList.remove('hidden-card'));
        unlinkBtn.style.display = 'none';
      }
    }

    function openPinModal(empId) {
      pendingEmpId = empId;
      document.getElementById('pinInput').value = '';
      document.getElementById('pinModal').classList.add('active');
      setTimeout(() => document.getElementById('pinInput').focus(), 100);
    }

    function closePinModal() {
      document.getElementById('pinModal').classList.remove('active');
      pendingEmpId = null;
    }

    async function submitPin() {
      const pin = document.getElementById('pinInput').value;
      if (!pin || pin.length < 4) {
        showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø±Ù‚Ø§Ù…', 'error');
        return;
      }

      const deviceId = generateDeviceId();
      const btn = document.querySelector('.btn-submit');
      const originalText = btn.textContent;
      btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
      btn.disabled = true;

      try {
        const res = await fetch('/link_device', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            employee_id: pendingEmpId,
            pin_code: pin,
            device_id: deviceId
          })
        });
        const data = await res.json();

        if (data.success) {
          // Store locally
          localStorage.setItem('kiosk_device_id', deviceId);
          localStorage.setItem('kiosk_linked_employee_id', pendingEmpId);

          showToast(`ØªÙ… Ø±Ø¨Ø· Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø­Ø³Ø§Ø¨ ${data.employee_name} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
          closePinModal();
          checkDeviceStatus();

          // Auto punch in/out after linking successfully
          setTimeout(() => punch(pendingEmpId), 500);
        } else {
          showToast(data.message || 'ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚', 'error');
          document.getElementById('pinInput').value = '';
        }
      } catch (e) {
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
      }

      btn.textContent = originalText;
      btn.disabled = false;
    }

    function unlinkDevice(silent = false) {
      if (!silent && !confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ÙÙƒ Ø§Ø±ØªØ¨Ø§Ø· Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø­Ø³Ø§Ø¨ÙƒØŸ Ø³ÙŠØªØ·Ù„Ø¨ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.')) return;

      localStorage.removeItem('kiosk_device_id');
      localStorage.removeItem('kiosk_linked_employee_id');
      if (!silent) showToast('ØªÙ… ÙÙƒ Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ù‡Ø§ØªÙ', 'success');
      checkDeviceStatus();
    }

    function requireAdminPin(actionTarget) {
      const pin = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© (Admin PIN):");
      if (pin === "1234") { // Temporary or config-based static pin. Let's assume 1234 for now or let server validate it.
        // Doing simple client-side check for now as requested for speed, but can easily be moved to backend
        if (actionTarget === '/admin') {
          window.location.href = actionTarget;
        } else if (actionTarget === 'unlink') {
          unlinkDevice(false);
        }
      } else if (pin !== null) {
        showToast("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø®Ø§Ø·Ø¦!", "error");
      }
    }

    // Initialize UI based on device link status
    checkDeviceStatus();

  </script>
</body>

</html>